clear all

max_order = 6;% ����ʱ��������������

% =======================����˫��ʹ�õĹ�ǿ===============================
mu = [0.5,0.2,0.1,0];% Alice��ǿ�����Ӵ�С˳�����У��������ź�̬
nu = [0.5,0.2,0.1,0];% Bob��ǿ�����Ӵ�С˳�����У��������ź�̬


% =======================����ʵ���������=================================

% ע�⣺���˫��ʹ�õĹ�ǿ��ͬ������������Ӧ����һ���Գ���
% Z��������Q_z�����ϼ���/��ƥ������bit���������е�i�е�j�д���ʹ��mu_i��nu_jʱ������
Q_z = [5.06e-5,2.02e-5,1.01e-5,2.51e-8;...
       1.99e-5,7.97e-6,4.02e-6,8.67e-9;...
       9.87e-6,4.01e-6,1.98e-6,4.49e-9;
       6.22e-8,1.38e-8,4.19e-9,0];
   
% X�������棬ͬ��
Q_x = [1.06e-4,5.18e-5,3.85e-5,2.73e-5;...
       5.20e-5,1.67e-5,9.51e-6,4.38e-6;...
       3.81e-5,9.30e-6,4.20e-6,1.12e-6;
       2.68e-5,4.16e-6,1.00e-6,3.0e-10];
   
   

% Z����������E_z������bit��/���ϼ����������е�i�е�j�д���ʹ��mu_i��nu_jʱ��������
E_z = [0.14,0.17,0.22,50;...
       0.22,0.19,0.21,41.38;...
       0.38,0.24,0.33,40;...
       53.37,50,35.71,50]*10^-2;
   
% X�������ʣ�ͬ��
E_x = [27.70,32.13,37.84,50.13;...
       31.90,27.67,31.02,51.07;...
       37.93,30.41,27.08,50.63;...
       49.85,49.74,50.36,50]*10^-2;
   

% ע�⣺���ʹ������һ��ʹ�����̬�����Ӧ��������Ӧ��0.5
% if mu(end)==0
%     E_x(end,:) = 0.5;
%     E_z(end,:) = 0.5;
% end
% 
% if nu(end) == 0
%     E_x(:,end)=0.5;
%     E_z(:,end)=0.5;
% end

% ����Y11��e11
[Y11_x,e11_x] = evaluate_Y11_and_e11_simp(Q_x,E_x,mu,nu,max_order,1e-5,0.01);
[Y11_z,e11_z] = evaluate_Y11_and_e11_simp(Q_z,E_z,mu,nu,max_order,1e-5,0.01);

% ����R��ע�����R��С����Ϊ1e-12����ʾû����Ч�İ�ȫ����
R = max([mu(1)*nu(1)*exp(-mu(1)-nu(1))*Y11_z*(1-Binary_Shannon_Entropy(e11_x))-...
    Q_z(1,1)*Correction_Efficiency(E_z(1,1))*Binary_Shannon_Entropy(E_z(1,1)),1e-12]);

   